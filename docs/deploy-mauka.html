<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Deployment: Mauka · Open Power Quality</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Deployment: Mauka · Open Power Quality"/><meta property="og:type" content="website"/><meta property="og:url" content="https://openpowerquality.org/index.html"/><meta property="og:description" content="There are basically three steps to deploying OPQMauka: building the production bundle (a Python application) on a development machine, installing OPQMauka on the production machine, and managing the OPQMauka service."/><link rel="shortcut icon" href="/img/opq.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://openpowerquality.org/blog/atom.xml" title="Open Power Quality Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://openpowerquality.org/blog/feed.xml" title="Open Power Quality Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/opqlogo_white.png" alt="Open Power Quality"/><h2 class="headerTitle">Open Power Quality</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/intro-opq.html" target="_self">Documentation</a></li><li class=""><a href="/docs/doc4.html" target="_self">Get Involved</a></li><li class=""><a href="/en/help.html" target="_self">About Us</a></li><li class=""><a href="/blog" target="_self">News</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Deployment</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/docs/intro-opq.html">What is OPQ?</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-why-power-quality.html">Why care about power quality?</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-power-quality.html">A beginners guide to power quality</a></li></ul></div><div class="navGroup navGroupActive"><h3>User Guide</h3><ul><li class="navListItem"><a class="navItem" href="/docs/userguide-hardware.html">OPQ Box</a></li><li class="navListItem"><a class="navItem" href="/docs/userguide-software.html">OPQ View</a></li></ul></div><div class="navGroup navGroupActive"><h3>OPQ Box Hardware</h3><ul><li class="navListItem"><a class="navItem" href="/docs/box-overview.html">Design Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/box-manufacturing.html">Manufacturing</a></li></ul></div><div class="navGroup navGroupActive"><h3>Software Services</h3><ul><li class="navListItem"><a class="navItem" href="/docs/datamodel.html">Data Model</a></li><li class="navListItem"><a class="navItem" href="/docs/view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/mauka.html">Mauka</a></li><li class="navListItem"><a class="navItem" href="/docs/health.html">Health</a></li><li class="navListItem"><a class="navItem" href="/docs/protocol.html">Protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/virtual-machine.html">VM &amp; Sim</a></li></ul></div><div class="navGroup navGroupActive"><h3>Deployment</h3><ul><li class="navListItem"><a class="navItem" href="/docs/deploy-initial-configuration.html">Initial Configuration</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/deploy-mauka.html">Mauka</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-health.html">Health</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Deployment: Mauka</h1></header><article><div><span><p>There are basically three steps to deploying OPQMauka: building the production bundle (a Python application) on a development machine, installing OPQMauka on the production machine, and managing the OPQMauka service.</p>
<h2><a class="anchor" aria-hidden="true" id="build-and-deploy-the-production-bundle"></a><a href="#build-and-deploy-the-production-bundle" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build and deploy the production bundle</h2>
<p>In general, you will build the production bundle from the master branch of OPQMauka.</p>
<p>In your development environment, be sure you are in the master branch, then change directories into the <code>opq/mauka/deploy/</code> directory.</p>
<p>This directory contains the following items:</p>
<ul>
<li>deploy-transfer.sh: Builds OPQMauka bundle and transfers to emilia.</li>
<li>deploy-run.sh: Installs the OPQMauka service and utilities on emilia.</li>
<li>mauka-service.sh: Service file that gets installed as system service.</li>
<li>mauka-cli.sh: Utility script for starting the mauka command line interface.</li>
<li>mauka-log.sh: Utility script for viewing mauka log.</li>
<li>[timestamp].tar.bz2 (local copies of created bundles)</li>
</ul>
<p>Now invoke <code>./deploy-transfer.sh</code>:</p>
<p>This script builds a OPQMauka bundle from the current branch as a compressed tar.bz2 archive. Once the archive is built, the script will copy the bundle to the server via SCP.</p>
<p>The following is an example run performed on one of our development machines.</p>
<pre><code class="hljs">+ cd ../..
++ date +%Y%m%d_%H%M%S
+ TIMESTAMP=<span class="hljs-number">20180410</span>_131135
+ mkdir -p mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135
+ mkdir -p mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135/mauka
+ cp -r mauka<span class="hljs-regexp">/constants mauka/</span>deploy<span class="hljs-regexp">/20180410_131135/</span>mauka
+ cp -r mauka<span class="hljs-regexp">/mongo mauka/</span>deploy<span class="hljs-regexp">/20180410_131135/</span>mauka
+ cp -r mauka<span class="hljs-regexp">/plugins mauka/</span>deploy<span class="hljs-regexp">/20180410_131135/</span>mauka
+ cp -r mauka<span class="hljs-regexp">/protobuf mauka/</span>deploy<span class="hljs-regexp">/20180410_131135/</span>mauka
+ cp mauka<span class="hljs-regexp">/config.json mauka/</span>deploy<span class="hljs-regexp">/20180410_131135/</span>mauka
+ cp mauka<span class="hljs-regexp">/OpqMauka.py mauka/</span>deploy<span class="hljs-regexp">/20180410_131135/</span>mauka
+ cp mauka<span class="hljs-regexp">/requirements.txt mauka/</span>deploy<span class="hljs-regexp">/20180410_131135/</span>mauka
+ mkdir -p mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135/scripts
+ cp mauka<span class="hljs-regexp">/deploy/</span>mauka-cli.sh mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135/scripts
+ cp mauka<span class="hljs-regexp">/deploy/</span>mauka-log.sh mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135/scripts
+ cp mauka<span class="hljs-regexp">/deploy/</span>mauka-service.sh mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135/scripts
+ cp mauka<span class="hljs-regexp">/deploy/</span>deploy-run.sh mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135
+ tar cvjf mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135.tar.bz2 -C mauka/deploy <span class="hljs-number">20180410</span>_131135
<span class="hljs-number">20180410</span>_131135/
<span class="hljs-number">20180410</span>_131135/deploy-run.sh
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>config.json
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>constants/
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>constants/__init__.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>mongo/
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>mongo/mongo.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>OpqMauka.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/AcquisitionTriggerPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/base.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/broker.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/FrequencyThresholdPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/history.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/IticPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/LocalityPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/manager.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/MeasurementPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/mock.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/PrintPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/StatusPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/ThdPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/ThresholdPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/VoltageThresholdPlugin.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>plugins/__init__.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>protobuf/
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>protobuf/opq.proto
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>protobuf/opq_pb2.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>protobuf/util.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>protobuf/__init__.py
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/mauka/</span>requirements.txt
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/scripts/</span>
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/scripts/</span>mauka-cli.sh
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/scripts/</span>mauka-log.sh
<span class="hljs-number">20180410</span>_131135<span class="hljs-regexp">/scripts/</span>mauka-service.sh
+ scp -P <span class="hljs-number">29862</span> mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135.tar.bz2 opquser<span class="hljs-meta">@emilia</span>.ics.hawaii.<span class="hljs-string">edu:</span><span class="hljs-regexp">/home/</span>opquser<span class="hljs-regexp">/mauka/</span>.
<span class="hljs-number">20180410</span>_131135.tar.bz2                                                                                                     <span class="hljs-number">100</span>%   <span class="hljs-number">22</span>KB  <span class="hljs-number">21.6</span>KB/s   <span class="hljs-number">00</span>:<span class="hljs-number">00</span>
+ rm -rf mauka<span class="hljs-regexp">/deploy/</span><span class="hljs-number">20180410</span>_131135
+ set +x
</code></pre>
<p>Note that *tar.bz2 files in the deploy directory are gitignored.</p>
<h2><a class="anchor" aria-hidden="true" id="server-side-deployment-tasks"></a><a href="#server-side-deployment-tasks" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Server-side deployment tasks</h2>
<p>Now ssh to the server to do the remainder of the deployment:</p>
<pre><code class="hljs">ssh -<span class="hljs-selector-tag">p</span> <span class="hljs-number">29862</span> opquser@emilia<span class="hljs-selector-class">.ics</span><span class="hljs-selector-class">.hawaii</span><span class="hljs-selector-class">.edu</span>
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="unpack-tar-file-with-latest-release"></a><a href="#unpack-tar-file-with-latest-release" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unpack tar file with latest release</h3>
<p>Change directories into the mauka/ subdirectory, and list the files:</p>
<pre><code class="hljs">opquser@emilia:~/mauka$ ls -al
total 32
drwxr-xr-x <span class="hljs-number"> 2 </span>opquser opquser <span class="hljs-number"> 4096 </span>Apr<span class="hljs-number"> 10 </span>13:19 .
drwxr-xr-x<span class="hljs-number"> 12 </span>opquser opquser <span class="hljs-number"> 4096 </span>Apr<span class="hljs-number"> 10 </span>12:13 ..
-rwxr-xr-x <span class="hljs-number"> 1 </span>opquser opquser<span class="hljs-number"> 22143 </span>Apr<span class="hljs-number"> 10 </span>13:11 20180410_131135.tar.bz2
</code></pre>
<p>You should see one (or more) timestamped tar.bz2 files (and potentially directories). The most recent timestamped tar.bz2 file is the one you just copied over.  Expand it into a directory as follows:</p>
<pre><code class="hljs">$ tar xf <span class="hljs-number">20180410</span>_131135<span class="hljs-selector-class">.tar</span><span class="hljs-selector-class">.bz2</span>
</code></pre>
<p>Then cd into that directory, and list the contents:</p>
<pre><code class="hljs">opquser<span class="hljs-variable">@emilia</span><span class="hljs-symbol">:~/mauka</span><span class="hljs-variable">$ </span>cd <span class="hljs-number">20180410_131135</span>/
opquser<span class="hljs-variable">@emilia</span><span class="hljs-symbol">:~/mauka/</span><span class="hljs-number">20180410_131135</span><span class="hljs-variable">$ </span>ls -al
total <span class="hljs-number">20</span>
drwxr-xr-x <span class="hljs-number">4</span> opquser opquser <span class="hljs-number">4096</span> Apr <span class="hljs-number">10</span> <span class="hljs-number">13</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span> .
drwxr-xr-x <span class="hljs-number">3</span> opquser opquser <span class="hljs-number">4096</span> Apr <span class="hljs-number">10</span> <span class="hljs-number">13</span><span class="hljs-symbol">:</span><span class="hljs-number">20</span> ..
-rwxr-xr-x <span class="hljs-number">1</span> opquser opquser  <span class="hljs-number">874</span> Apr <span class="hljs-number">10</span> <span class="hljs-number">13</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span> deploy-run.sh
drwxr-xr-x <span class="hljs-number">6</span> opquser opquser <span class="hljs-number">4096</span> Apr <span class="hljs-number">10</span> <span class="hljs-number">13</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span> mauka
drwxr-xr-x <span class="hljs-number">2</span> opquser opquser <span class="hljs-number">4096</span> Apr <span class="hljs-number">10</span> <span class="hljs-number">13</span><span class="hljs-symbol">:</span><span class="hljs-number">11</span> scripts
opquser<span class="hljs-variable">@emilia</span><span class="hljs-symbol">:~/mauka/</span><span class="hljs-number">20180410_131135</span><span class="hljs-variable">$
</span></code></pre>
<h3><a class="anchor" aria-hidden="true" id="kill-the-current-opqmauka-process"></a><a href="#kill-the-current-opqmauka-process" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Kill the current OPQMauka process</h3>
<p>OPQMauka is installed as a system service which runs under the opq system user account. This is a special account that does not have a login shell which provides hardened security. The other advantage to running as a system service is that the service will automatically boot if the server restarts. Further, the service can be managed by the operating system's <code>service</code> command.</p>
<p>To kill the current OPQMauka service, invoke</p>
<p><code>sudo service mauka stop</code></p>
<h3><a class="anchor" aria-hidden="true" id="install-the-new-version-of-opqmauka"></a><a href="#install-the-new-version-of-opqmauka" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install the new version of OPQMauka</h3>
<p>To install OPQMauka, simple run the <code>deploy-run.sh</code> script as root.</p>
<pre><code class="hljs">opquser@emilia:~/mauka/20180410_131135$ sudo ./deploy-<span class="hljs-keyword">run</span>.<span class="hljs-keyword">sh</span>
+ cp scripts/mauka-service.<span class="hljs-keyword">sh</span> /etc/init.<span class="hljs-keyword">d</span>/mauka
+ <span class="hljs-keyword">update</span>-rc.<span class="hljs-keyword">d</span> mauka defaults
+ cp scripts/mauka-<span class="hljs-keyword">cli</span>.<span class="hljs-keyword">sh</span> /usr/<span class="hljs-keyword">local</span>/bin/mauka-<span class="hljs-keyword">cli</span>
+ chmod +x /usr/<span class="hljs-keyword">local</span>/bin/mauka-<span class="hljs-keyword">cli</span>
+ cp scripts/mauka-<span class="hljs-keyword">log</span>.<span class="hljs-keyword">sh</span> /usr/<span class="hljs-keyword">local</span>/bin/mauka-<span class="hljs-built_in">log</span>
+ chmod +x /usr/<span class="hljs-keyword">local</span>/bin/mauka-<span class="hljs-built_in">log</span>
+ <span class="hljs-keyword">mkdir</span> -p /usr/<span class="hljs-keyword">local</span>/bin/opq
+ chown -R opq:opq /usr/<span class="hljs-keyword">local</span>/bin/opq
+ cp -R mauka /usr/<span class="hljs-keyword">local</span>/bin/opq/.
+ cp mauka/config.json /etc/opq/mauka/config.json
+ <span class="hljs-keyword">mkdir</span> -p /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/opq
+ chown -R opq:opq /<span class="hljs-keyword">var</span>/<span class="hljs-keyword">log</span>/opq
+ <span class="hljs-keyword">set</span> +o xtrace
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="run-the-new-version-of-opqmauka"></a><a href="#run-the-new-version-of-opqmauka" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run the new version of OPQMauka</h3>
<p>To run the new version of OPQMauka, start the service with</p>
<p><code>sudo service mauka start</code></p>
<p>The service will run as a daemon process with all log information going to <code>/var/log/opq/mauka.log</code>. This file can be tailed and monitored in real time by running the shortcut <code>mauka-log</code>.</p>
<h2><a class="anchor" aria-hidden="true" id="verify-that-the-new-opqmauka-is-running"></a><a href="#verify-that-the-new-opqmauka-is-running" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Verify that the new OPQMauka is running</h2>
<h3><a class="anchor" aria-hidden="true" id="check-the-process-list"></a><a href="#check-the-process-list" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Check the process list</h3>
<p>Check the process list with <code>ps aux | grep Mauka</code> and you should see a process for each plugin running under the user <code>opq</code></p>
<pre><code class="hljs">opquser<span class="hljs-meta">@emilia</span>:~$ ps aux | grep Mauka
opq      <span class="hljs-number">14403</span> <span class="hljs-number">10.3</span>  <span class="hljs-number">0.5</span> <span class="hljs-number">339040</span> <span class="hljs-number">45704</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">41</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opq      <span class="hljs-number">14417</span>  <span class="hljs-number">0.2</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">256992</span> <span class="hljs-number">37744</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opq      <span class="hljs-number">14418</span>  <span class="hljs-number">0.2</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">257128</span> <span class="hljs-number">36880</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">01</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opq      <span class="hljs-number">14421</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">552088</span> <span class="hljs-number">38660</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opq      <span class="hljs-number">14424</span>  <span class="hljs-number">0.3</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">552108</span> <span class="hljs-number">38804</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">01</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opq      <span class="hljs-number">14425</span>  <span class="hljs-number">0.3</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">552116</span> <span class="hljs-number">38812</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">01</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opq      <span class="hljs-number">14427</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">552140</span> <span class="hljs-number">38660</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opq      <span class="hljs-number">14432</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">625888</span> <span class="hljs-number">38832</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opq      <span class="hljs-number">14437</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.4</span> <span class="hljs-number">634104</span> <span class="hljs-number">38776</span> ?        Sl   13:<span class="hljs-number">23</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 /</span>usr<span class="hljs-regexp">/local/</span>bin<span class="hljs-regexp">/opq/</span>mauka<span class="hljs-regexp">/OpqMauka.py /</span>etc<span class="hljs-regexp">/opq/</span>mauka/config.json
opquser  <span class="hljs-number">14836</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">0.0</span>  <span class="hljs-number">12728</span>  <span class="hljs-number">2220</span> pts/<span class="hljs-number">3</span>    S+   <span class="hljs-number">13</span>:<span class="hljs-number">30</span>   <span class="hljs-number">0</span>:<span class="hljs-number">00</span> grep Mauka
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="check-plugin-status-with-mauka-cli"></a><a href="#check-plugin-status-with-mauka-cli" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Check plugin status with mauka-cli</h3>
<p>Start the mauka command line interface <code>mauka-cli</code></p>
<pre><code class="hljs">opquser@emilia:~$ mauka-cli
[<span class="hljs-string">INFO</span>][<span class="hljs-symbol">2018-04-10 13:32:36,814</span>][<span class="hljs-string">14947 manager.py:565 - &lt;module&gt;() </span>] Starting OpqMauka CLI
[<span class="hljs-string">INFO</span>][<span class="hljs-symbol">2018-04-10 13:32:36,814</span>][<span class="hljs-string">14947 manager.py:553 - load_config() </span>] Loading configuration from /etc/opq/mauka/config.json
</code></pre>
<p>To check the status of the plugins, provide the command <code>list-plugins</code></p>
<pre><code class="hljs">opq-mauka&gt; list-plugins
[DEBUG][<span class="hljs-number">2018</span><span class="hljs-number">-04</span><span class="hljs-number">-10</span> <span class="hljs-number">13</span>:<span class="hljs-number">33</span>:<span class="hljs-number">24</span>,<span class="hljs-number">780</span>][<span class="hljs-number">14947</span> manager.<span class="hljs-string">py:</span><span class="hljs-number">541</span> - run_cli() ] <span class="hljs-string">name:</span>AcquisitionTriggerPlugin       <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-8</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14437</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>FrequencyThresholdPlugin       <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-4</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14424</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>IticPlugin                     <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-3</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14421</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>StatusPlugin                   <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-7</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14432</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>ThdPlugin                      <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-6</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14427</span> <span class="hljs-string">exit_event:</span>False
<span class="hljs-string">name:</span>VoltageThresholdPlugin         <span class="hljs-string">enabled:</span>Yes <span class="hljs-string">process:</span>&lt;Process(Process<span class="hljs-number">-5</span>, started)&gt; <span class="hljs-string">pid:</span><span class="hljs-number">14425</span> <span class="hljs-string">exit_event:</span>False
</code></pre>
<p>Here, we see that the plugins are enabled, started, and not set to exit which shows they are are in working order.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="deploy-initial-configuration.html">← Deployment: Initial Configuration</a><a class="docs-next button" href="deploy-makai.html">Deployment: Makai →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#build-and-deploy-the-production-bundle">Build and deploy the production bundle</a></li><li><a href="#server-side-deployment-tasks">Server-side deployment tasks</a><ul class="toc-headings"><li><a href="#unpack-tar-file-with-latest-release">Unpack tar file with latest release</a></li><li><a href="#kill-the-current-opqmauka-process">Kill the current OPQMauka process</a></li><li><a href="#install-the-new-version-of-opqmauka">Install the new version of OPQMauka</a></li><li><a href="#run-the-new-version-of-opqmauka">Run the new version of OPQMauka</a></li></ul></li><li><a href="#verify-that-the-new-opqmauka-is-running">Verify that the new OPQMauka is running</a><ul class="toc-headings"><li><a href="#check-the-process-list">Check the process list</a></li><li><a href="#check-plugin-status-with-mauka-cli">Check plugin status with mauka-cli</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/opqlogo_white.png" alt="Open Power Quality" width="66" height="58"/></a><div><h5>Documentation</h5><a href="/docs/en/doc1.html">Power Quality Overview</a><a href="/docs/en/doc2.html">OPQ Boxes</a><a href="/docs/en/doc3.html">OPQ View</a></div><div><h5>Community</h5><a href="http://slack.com/openpowerquality" target="_blank" rel="noreferrer noopener">Slack</a><a href="https://twitter.com/opquality" target="_blank" rel="noreferrer noopener">Twitter</a></div><div><h5>Development</h5><a href="/blog">News</a><a href="https://github.com/openpowerquality">GitHub</a><a href="https://github.com/openpowerquality/opq/projects/1">Project Board</a></div></section></footer></div></body></html>