<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Deployment: Makai · Open Power Quality</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Deployment: Makai · Open Power Quality"/><meta property="og:type" content="website"/><meta property="og:url" content="https://openpowerquality.org/index.html"/><meta property="og:description" content="Makai has three main components: a Triggering Broker, an Acquisition Broker, and a Triggering Service (the makai daemon)."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/opq.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://openpowerquality.org/blog/atom.xml" title="Open Power Quality Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://openpowerquality.org/blog/feed.xml" title="Open Power Quality Blog RSS Feed"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.css"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gugi"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.9.0/dist/katex.min.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/opqlogo_white.png" alt="Open Power Quality"/><h2 class="headerTitle">Open Power Quality</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/intro-motivation.html" target="_self">Documentation</a></li><li class="siteNavGroupActive"><a href="/docs/opportunities.html" target="_self">Opportunities</a></li><li class=""><a href="/blog" target="_self">News</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Deployment</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/docs/intro-motivation.html">Motivation for OPQ</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-power-quality.html">A beginners guide to power quality</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-opq.html">What is OPQ?</a></li></ul></div><div class="navGroup navGroupActive"><h3>User Guide</h3><ul><li class="navListItem"><a class="navItem" href="/docs/userguide-hardware.html">OPQ Box</a></li><li class="navListItem"><a class="navItem" href="/docs/userguide-software.html">OPQ View</a></li></ul></div><div class="navGroup navGroupActive"><h3>Hardware</h3><ul><li class="navListItem"><a class="navItem" href="/docs/box-overview.html">Design Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/box-updater.html">Updater</a></li><li class="navListItem"><a class="navItem" href="/docs/box-manufacturing.html">Manufacturing</a></li></ul></div><div class="navGroup navGroupActive"><h3>Software</h3><ul><li class="navListItem"><a class="navItem" href="/docs/datamodel.html">Data Model</a></li><li class="navListItem"><a class="navItem" href="/docs/view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/mauka.html">Mauka</a></li><li class="navListItem"><a class="navItem" href="/docs/makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/health.html">Health</a></li><li class="navListItem"><a class="navItem" href="/docs/protocol.html">Protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/virtual-machine.html">VM &amp; Sim</a></li></ul></div><div class="navGroup navGroupActive"><h3>Deployment</h3><ul><li class="navListItem"><a class="navItem" href="/docs/deploy-initial-configuration.html">Initial Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-mauka.html">Mauka</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/deploy-makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-health.html">Health</a></li></ul></div><div class="navGroup navGroupActive"><h3>Developer Guide</h3><ul><li class="navListItem"><a class="navItem" href="/docs/developerguide-docusaurus.html">Documentation</a></li></ul></div><div class="navGroup navGroupActive"><h3>Other</h3><ul><li class="navListItem"><a class="navItem" href="/docs/roadmap.html">Roadmap</a></li><li class="navListItem"><a class="navItem" href="/docs/opportunities.html">R&amp;D Opportunities</a></li><li class="navListItem"><a class="navItem" href="/docs/agile-power-monitoring.html">Agile Power Monitoring for UH</a></li><li class="navListItem"><a class="navItem" href="/docs/g1-pilot-study.html">G1 Pilot Study (2014)</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Deployment: Makai</h1></header><article><div><span><p>Makai has three main components: a Triggering Broker, an Acquisition Broker, and a Triggering Service (the makai daemon).</p>
<p>Each one is a self-contained application, requiring their own dependencies. The Triggering and Acquisition Brokers are written in C++ and as such require C/C++ libraries. The Makai daemon, the core of the triggering service, is written in Rust. This make dependency management simpler because we can use the <code>cargo</code> system.</p>
<h2><a class="anchor" aria-hidden="true" id="simple-installation"></a><a href="#simple-installation" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Simple installation</h2>
<p>At this time, unlike other OPQ services, you must build the Makai service directly from sources on the server machine.</p>
<p>First, login as opquser on the server.</p>
<p>Change directories to the makai/ directory.</p>
<p>Next, checkout the <a href="https://github.com/openpowerquality/opq">opq repository</a> into this directory.</p>
<p>As long as all the dependencies are satisfied, it is sufficient to run <code>build_and_install.sh</code> script in the opq/makai directory to install all the makai system, and configure it to run at startup. However, configuration files and need to be copied and edited manually to match your use case.</p>
<p>The following sections document how to build each of the three applications manually.</p>
<h2><a class="anchor" aria-hidden="true" id="build-the-triggering-broker"></a><a href="#build-the-triggering-broker" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build the Triggering Broker</h2>
<p>The Triggering Broker requires the following C/C++ libraries:</p>
<ul>
<li>ZeroMQ &gt;= v4.2: <a href="http://zeromq.org/intro:get-the-software">Installation instructions</a></li>
<li>zmqpp &gt;= v4.2 : <a href="https://github.com/zeromq/zmqpp#installation">Installation instructions</a></li>
</ul>
<p>Furthermore the triggering broker requires gcc &gt;= v6.3, as well as a recent version of cmake.</p>
<p>If you would like to build the Triggering Broker without using <code>build_and_install.sh</code>, then follow these steps:</p>
<ol>
<li><code>cd TriggeringBroker/</code> : switch to the triggering broker directory.</li>
<li><code>mkdir -p build</code> : create a directory where the build will take place.</li>
<li><code>cd build</code> : switch to the build directory.</li>
<li><code>cmake ..</code> : run cmake pointing to the source of the triggering broker.</li>
<li><code>make</code> : build the binary.</li>
</ol>
<p>This will generate the <code>TriggeringBroker</code> binary. Follow the directions in the <a href="/docs/makai.html#configuration">Software Services</a> section for configuration.</p>
<h2><a class="anchor" aria-hidden="true" id="build-the-acquisition-broker"></a><a href="#build-the-acquisition-broker" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build the Acquisition Broker</h2>
<p>The Acquisition Broker requires the following C/C++ libraries:</p>
<ul>
<li>ZeroMQ &gt;= v4.2: <a href="http://zeromq.org/intro:get-the-software">Installation instructions</a></li>
<li>zmqpp &gt;= v4.2 : <a href="https://github.com/zeromq/zmqpp#installation">Installation instructions</a></li>
<li>protobuf : <a href="https://github.com/google/protobuf/blob/master/src/README.md">Installation instructions</a></li>
<li>mongocxx : <a href="http://mongodb.github.io/mongo-cxx-driver/mongocxx-v3/installation/">Installation instructions</a></li>
</ul>
<p>Furthermore the acquisition broker requires gcc &gt;= v6.3, as well as a recent version of cmake.</p>
<p>If you would like to build the Acquisition Broker without using <code>build_and_install.sh</code>, then follow these steps:</p>
<ol>
<li><code>cd AcquisitionBroker/</code> : switch to the triggering broker directory.</li>
<li><code>mkdir -p build</code> : create a directory where the build will take place.</li>
<li><code>cd build</code> : switch to the build directory.</li>
<li><code>cmake ..</code> : run cmake pointing to the source of the triggering broker.</li>
<li><code>make</code> : build the binary.</li>
</ol>
<p>This will generate the <code>AcquisitionBroker</code> binary. Follow the directions in the <a href="/docs/makai.html#configuration">Software Services</a> section for configuration.</p>
<h2><a class="anchor" aria-hidden="true" id="build-the-triggering-service"></a><a href="#build-the-triggering-service" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build the Triggering Service</h2>
<p>The Triggering Service is written in Rust, and as such most of the dependency management is satisfied via cargo. However there are a few cases where native rust code does not exists for certain libraries. Instead, we use a shim package which wraps a C library. The list of C libraries is shown below:</p>
<ul>
<li>protobuf : <a href="https://github.com/google/protobuf/blob/master/src/README.md">Installation instructions</a></li>
<li>ZeroMQ &gt;= v4.2: <a href="http://zeromq.org/intro:get-the-software">Installation instructions</a></li>
</ul>
<p>The Triggering Service also requires a stable branch of the <a href="https://www.rust-lang.org/en-US/install.html">Rust</a> compiler.</p>
<p><strong>Serge: What scripts are invoked to actually build the Triggering Service?</strong></p>
<h2><a class="anchor" aria-hidden="true" id="build-the-makai-service"></a><a href="#build-the-makai-service" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Build the Makai Service</h2>
<p>If you would like to build the makai service and plugins without using <code>build_and_install.sh</code>, switch into the <code>TriggeringService</code> directory and run the <code>build.sh</code> script. This will generate the <code>makai</code> binary as well as all the plugins in the build directory.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="deploy-mauka.html">← Deployment: Mauka</a><a class="docs-next button" href="deploy-view.html">Deployment: View →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#simple-installation">Simple installation</a></li><li><a href="#build-the-triggering-broker">Build the Triggering Broker</a></li><li><a href="#build-the-acquisition-broker">Build the Acquisition Broker</a></li><li><a href="#build-the-triggering-service">Build the Triggering Service</a></li><li><a href="#build-the-makai-service">Build the Makai Service</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/opqlogo_white.png" alt="Open Power Quality" width="66" height="58"/></a><div><h5>Documentation Quick Links</h5><a href="/docs/intro-opq.html">Overview</a><a href="/docs/userguide-hardware.html">OPQ Box User Guide</a><a href="/docs/userguide-software.html">OPQ View User Guide</a><a href="/docs/agile-power-monitoring.html">Agile Power Monitoring for UH</a><a href="/docs/roadmap.html">Roadmap</a></div><div><h5>Community</h5><a href="https://openpowerquality.slack.com/" target="_blank" rel="noreferrer noopener">Slack</a><a href="https://twitter.com/opquality" target="_blank" rel="noreferrer noopener">Twitter</a><a href="/blog">News</a><a href="http://emilia.ics.hawaii.edu">Emilia (public OPQ View)</a><a href="/contact-us.html">Contact Us</a></div><div><h5>Development</h5><a href="https://github.com/openpowerquality">GitHub</a><a href="https://github.com/openpowerquality/opq/projects/1">Project Board</a><a href="/team.html">Developer Team</a><a href="/docs/opportunities.html">Opportunities</a><a href="http://www.citeulike.org/group/3370/tag/powerquality">Publications</a></div></section><p style="text-align:center;color:#e9faff;">Open Power Quality is sponsored by:<br/><a style="text-align:center;color:#e9faff;" href="http://csdl.ics.hawaii.edu">Collaborative Software Development Laboratory, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff;" href="http://www.ics.hawaii.edu">Department of Information and Computer Sciences, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff;" href="http://ee.hawaii.edu">Department of Electrical Engineering, University of Hawaii</a><br/></p></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '9bf16cc78135dbeeb3826894ebbbb2ee',
                indexName: 'openpowerquality',
                inputSelector: '#search_input_react'
              });
            </script></body></html>